<!DOCTYPE html>  <html> <head>   <title>pullitup.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               pullitup.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Be sure $ is what we want it to be</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$ = </span><span class="nx">jQuery</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Memoize window jQuery object</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$window = </span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The Pullitup class is the manager that will scroll</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Pullitup</span>
  <span class="nv">constructor: </span><span class="nf">(@container) -&gt;</span>
    <span class="vi">@items = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Current scrollTop</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@last_scroll_top = </span><span class="nx">@container</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>TODO: Implement scaling</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@base_resolution =</span>
      <span class="nv">width: </span><span class="nx">@container</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
      <span class="nv">height: </span><span class="nx">@container</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>

    <span class="vi">@scale = </span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Bind events</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@bindAll</span><span class="p">()</span>
    <span class="nx">@setScaleFromActualResolution</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Auxiliary method for initialization, binds events that we want to handle
in our Scroller class</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bindAll: </span><span class="o">-&gt;</span>
    <span class="nx">@container</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;scroll&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nv">scrollTop = </span><span class="nx">@container</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">()</span>
      <span class="nv">direction = </span><span class="k">if</span> <span class="nx">@last_scroll_top</span> <span class="o">&lt;</span> <span class="nx">scrollTop</span> <span class="k">then</span> <span class="s">&#39;down&#39;</span> <span class="k">else</span> <span class="s">&#39;up&#39;</span>
      <span class="nx">@processScrollAt</span><span class="p">(</span><span class="nx">scrollTop</span><span class="p">,</span> <span class="nx">direction</span><span class="p">)</span>
      <span class="vi">@last_scroll_top = </span><span class="nx">scrollTop</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Yo</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@container</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;resize&#39;</span><span class="p">,</span> <span class="o">=&gt;</span> <span class="nx">@handleResize</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Subscribes an item to be animated and positioned by the Scroller
on scrollTop min or max reached
The options</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">listen: </span><span class="nf">(sel, opts) -&gt;</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">ScrollableItem</span><span class="p">(</span>
      <span class="nx">sel</span><span class="p">,</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">@scale</span><span class="p">,</span> <span class="nx">@last_scroll_top</span><span class="p">,</span> <span class="nx">@sizes</span>
    <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Propagates scroll to scrollable items</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">processScrollAt: </span><span class="nf">(y) -&gt;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@items</span><span class="p">,</span> <span class="nf">(i, item) -&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">scrolledAt</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Handles $container's resizing and changes scale for children</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">handleResize: </span><span class="o">-&gt;</span>
    <span class="nx">@setScaleFromActualResolution</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Resize items</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@items</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">resizeToScale</span> <span class="nx">@scale</span><span class="p">,</span> <span class="nx">@sizes</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Simulate new scroll so every element's positions are refreshed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@container</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&#39;scroll&#39;</span><span class="p">)</span>

  <span class="nv">setBaseResolution: </span><span class="nf">(res) -&gt;</span>
    <span class="vi">@base_resolution = </span><span class="nx">res</span>
    <span class="nx">@setScaleFromActualResolution</span><span class="p">()</span>

  <span class="nv">setScaleFromActualResolution: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Actual sizes and ratios</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="nx">aw</span><span class="p">,</span> <span class="nx">ah</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">@container</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">@container</span><span class="p">.</span><span class="nx">height</span><span class="p">()]</span>
    <span class="nv">actual_ratio = </span><span class="nx">aw</span> <span class="o">/</span> <span class="nx">ah</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Base ones</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="nx">bw</span><span class="p">,</span> <span class="nx">bh</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">@base_resolution</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">@base_resolution</span><span class="p">.</span><span class="nx">height</span><span class="p">]</span>
    <span class="nv">base_ratio = </span><span class="nx">bw</span> <span class="o">/</span> <span class="nx">bh</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>If width should be adapted</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">actual_ratio</span> <span class="o">&gt;=</span> <span class="nx">base_ratio</span>
      <span class="nv">width = </span><span class="nx">aw</span>
      <span class="nv">height = </span><span class="nx">bh</span> <span class="o">*</span> <span class="p">(</span><span class="nx">aw</span> <span class="o">/</span> <span class="nx">bw</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Else, height should be adapted</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span>
      <span class="nv">width = </span><span class="nx">bw</span> <span class="o">*</span> <span class="p">(</span><span class="nx">ah</span> <span class="o">/</span> <span class="nx">bh</span><span class="p">)</span>
      <span class="nv">height = </span><span class="nx">aw</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Set scale from processed sizes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@scale = </span><span class="nx">width</span> <span class="o">/</span> <span class="nx">bw</span>

    <span class="vi">@sizes =</span>
      <span class="nv">width: </span><span class="nx">@base_resolution</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">@scale</span>
      <span class="nv">height: </span><span class="nx">@base_resolution</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">@scale</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Define offset to center items if screen width is greater than used width</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">offset: </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">aw</span> <span class="o">-</span> <span class="nx">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>



<span class="k">class</span> <span class="nx">ScrollableItem</span>
  <span class="nv">constructor: </span><span class="nf">(sel, params, @scale, y, @parent_sizes) -&gt;</span>
    <span class="vi">@el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">sel</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Fade params</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@fadeIn = </span><span class="nx">params</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">fade</span>
    <span class="vi">@fadeOut = </span><span class="nx">params</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">fade</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Ease on move ?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@easeMoveIn = </span><span class="nx">params</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">easeMove</span>
    <span class="vi">@easeMoveOut = </span><span class="nx">params</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">easeMove</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Check for defined easigns</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@inEasing = </span><span class="nx">params</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">easing</span> <span class="o">||</span> <span class="s">&#39;linear&#39;</span>
    <span class="vi">@outEasing = </span><span class="nx">params</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">easing</span> <span class="o">||</span> <span class="s">&#39;linear&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Store params for later processing</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@params = </span><span class="nx">params</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@last_params = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Get elements size before resizing</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@sizes =</span>
      <span class="nv">width: </span><span class="nx">@el</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
      <span class="nv">height: </span><span class="nx">@el</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Set base size of elements</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@resizeToScale</span><span class="p">(</span><span class="nx">@scale</span><span class="p">,</span> <span class="nx">@parent_sizes</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Process positions from strings &amp; others</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@processPositions</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Init position and set visibility</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@initPositionAt</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Recalculate position bounds</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">processPositions: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Init with blank positions hash</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@positions = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Process each position params hash</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@params</span><span class="p">,</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">return</span> <span class="k">if</span> <span class="nx">key</span> <span class="o">==</span> <span class="s">&#39;refObject&#39;</span> <span class="o">||</span> <span class="nx">key</span> <span class="o">==</span> <span class="s">&#39;onResize&#39;</span> <span class="o">||</span> <span class="nx">key</span> <span class="o">==</span> <span class="s">&#39;alwaysVisible&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Allow not to set :end positions if they're the same as :start ones
0 ... false ...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">x = </span><span class="k">if</span> <span class="nx">key</span> <span class="o">==</span> <span class="s">&#39;end&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">hash</span><span class="p">.</span><span class="nx">x</span> <span class="o">&amp;&amp;</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">x</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">@params</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">].</span><span class="nx">x</span> <span class="k">else</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">x</span>
      <span class="nv">y = </span><span class="k">if</span> <span class="nx">key</span> <span class="o">==</span> <span class="s">&#39;end&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">hash</span><span class="p">.</span><span class="nx">y</span> <span class="o">&amp;&amp;</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">y</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">@params</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">].</span><span class="nx">y</span> <span class="k">else</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Position hash calculation</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@positions</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Process bounds</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">bounds: </span><span class="k">if</span> <span class="k">typeof</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">bounds</span> <span class="o">==</span> <span class="s">&#39;number&#39;</span> <span class="k">then</span> <span class="nx">@valueForPosition</span><span class="p">(</span><span class="nx">hash</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span>
        <span class="k">else</span> <span class="nx">$</span><span class="p">.</span><span class="nx">map</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">bounds</span><span class="p">,</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">@valueForPosition</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Coords when item position is @ key</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">x: </span><span class="nx">@valueForPosition</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="nx">@parent_sizes</span><span class="p">.</span><span class="nx">offset</span>
        <span class="nv">y: </span><span class="nx">@valueForPosition</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Allow not to set :fixed key, so we can create simple linear trajectories</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">@positions</span><span class="p">.</span><span class="nx">fixed</span>
      <span class="nv">bound = </span><span class="nx">@positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">bounds</span> <span class="o">-</span>
        <span class="p">((</span><span class="nx">@positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">bounds</span> <span class="o">-</span> <span class="nx">@positions</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
      <span class="nv">center = </span><span class="nx">@positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="p">((</span><span class="nx">@positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@positions</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
      <span class="nv">middle = </span><span class="nx">@positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">((</span><span class="nx">@positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@positions</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
      <span class="vi">@positions.fixed =</span>
        <span class="nv">bounds: </span><span class="p">[</span><span class="nx">bound</span><span class="p">,</span> <span class="nx">bound</span><span class="p">]</span>
        <span class="nv">x: </span><span class="nx">center</span>
        <span class="nv">y: </span><span class="nx">middle</span>

  <span class="nv">initPositionAt: </span><span class="nf">(y) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Store if item is visible</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@visible = </span><span class="nx">@visibility</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Give good position</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@visible</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">@el</span><span class="p">.</span><span class="nx">fadeIn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@el</span><span class="p">.</span><span class="nx">fadeOut</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Set fixed position so we can move @el as we want to</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@el</span><span class="p">.</span><span class="nx">css</span> <span class="nv">position: </span><span class="s">&#39;fixed&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Force trigger scroll method</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@scrolledAt</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Get value from parameter position
Allows us to pass string parameters in x and y options for each state</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">valueForPosition: </span><span class="nf">(n) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">n</span> <span class="o">==</span> <span class="s">&#39;number&#39;</span>
      <span class="nx">n</span> <span class="o">*</span> <span class="nx">@scale</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Extract position and maybe inset setting</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">[</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">set</span><span class="p">]</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Default to outset</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">inset = </span><span class="nx">set</span><span class="o">?</span> <span class="o">&amp;&amp;</span> <span class="nx">set</span> <span class="o">==</span> <span class="s">&#39;inset&#39;</span>
      <span class="nv">position = </span><span class="k">switch</span> <span class="nx">pos</span>
        <span class="k">when</span> <span class="s">&#39;left&#39;</span>
          <span class="k">if</span> <span class="nx">inset</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="nx">@el</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">()</span>
        <span class="k">when</span> <span class="s">&#39;right&#39;</span>
          <span class="nv">ww = </span><span class="nx">@parent_sizes</span><span class="p">.</span><span class="nx">width</span>
          <span class="k">if</span> <span class="nx">inset</span> <span class="k">then</span> <span class="nx">ww</span> <span class="o">-</span> <span class="nx">@el</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">()</span> <span class="k">else</span> <span class="nx">ww</span>
        <span class="k">when</span> <span class="s">&#39;top&#39;</span>
          <span class="k">if</span> <span class="nx">inset</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="nx">@el</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()</span>
        <span class="k">when</span> <span class="s">&#39;bottom&#39;</span>
          <span class="nv">wh = </span><span class="nx">@parent_sizes</span><span class="p">.</span><span class="nx">height</span>
          <span class="k">if</span> <span class="nx">inset</span> <span class="k">then</span> <span class="nx">wh</span> <span class="o">-</span> <span class="nx">@el</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()</span> <span class="k">else</span> <span class="nx">wh</span>
        <span class="k">when</span> <span class="s">&#39;center&#39;</span> <span class="k">then</span> <span class="p">(</span><span class="nx">@parent_sizes</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">@el</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">when</span> <span class="s">&#39;middle&#39;</span> <span class="k">then</span> <span class="p">(</span><span class="nx">@parent_sizes</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">@el</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Scale processed value</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">position</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>ScrollHandler, fetch positions and call animation method depending on
item's current visibility</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scrolledAt: </span><span class="nf">(y, force = false) -&gt;</span>
    <span class="nv">visibility = </span><span class="nx">@visibility</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Don't do anything if we are not in</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">if</span> <span class="o">!</span><span class="nx">visibility</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">@visible</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">force</span>

    <span class="k">switch</span> <span class="nx">visibility</span>
      <span class="k">when</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="nx">@animateTo</span><span class="p">(</span><span class="nv">top: </span><span class="nx">@positions</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nv">left: </span><span class="nx">@positions</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
      <span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="nx">@animateTo</span><span class="p">(</span><span class="nv">top: </span><span class="nx">@positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nv">left: </span><span class="nx">@positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
      <span class="k">when</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">@animateTo</span><span class="p">(</span><span class="nx">@getAnimationParamsAt</span><span class="p">(</span><span class="nx">y</span><span class="p">),</span> <span class="kc">true</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Get item visibility for a given y
  * -1 if we're before animation start
  *  0 if we're should be animating item
  *  1 if we're after animation end</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">visibility: </span><span class="nf">(y) -&gt;</span>
    <span class="k">switch</span>
      <span class="k">when</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">@positions</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">bounds</span> <span class="k">then</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">when</span> <span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">@positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">bounds</span> <span class="k">then</span> <span class="mi">1</span>
      <span class="k">else</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Animates item to position given by {top, left} hash and handles visiblity
change so the scroll handler is not called when not necessary</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">animateTo: </span><span class="nf">(params, visible) -&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">params</span> <span class="o">==</span> <span class="nx">@last_params</span>
    <span class="vi">@last_params = </span><span class="nx">params</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Animate item to params</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@el</span><span class="p">.</span><span class="nx">stop</span><span class="p">().</span><span class="nx">animate</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>If visible state changed with this animation</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">visible</span> <span class="o">!=</span> <span class="nx">@visible</span>
      <span class="vi">@visible = </span><span class="nx">visible</span>
      <span class="k">if</span> <span class="nx">visible</span> <span class="o">||</span> <span class="nx">@params</span><span class="p">.</span><span class="nx">alwaysVisible</span>
        <span class="nx">@el</span><span class="p">.</span><span class="nx">fadeIn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nx">@el</span><span class="p">.</span><span class="nx">fadeOut</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Calculates coords to use for the current animation state
Handles easing based on options passed to the constructor leveraging
jQuery.easing available easing methods, so the position and opacity of
the element can be eased.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getAnimationParamsAt: </span><span class="nf">(y) -&gt;</span>
    <span class="k">if</span> <span class="nx">@params</span><span class="p">.</span><span class="nx">refObject</span>
      <span class="nv">positions = </span><span class="nx">@processPositionsFromRefObjectAt</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">positions = </span><span class="nx">@positions</span>

    <span class="nv">fixed_start = </span><span class="nx">positions</span><span class="p">.</span><span class="nx">fixed</span><span class="p">.</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nv">fixed_end = </span><span class="nx">positions</span><span class="p">.</span><span class="nx">fixed</span><span class="p">.</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nv">starts_at = </span><span class="nx">positions</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">bounds</span>
    <span class="nv">ends_at = </span><span class="nx">positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">bounds</span>

    <span class="k">if</span> <span class="nx">y</span> <span class="o">&gt;=</span> <span class="nx">fixed_start</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">fixed_end</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>If we must keep fixed state</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">{</span>
        <span class="nv">top: </span><span class="nx">positions</span><span class="p">.</span><span class="nx">fixed</span><span class="p">.</span><span class="nx">y</span> <span class="c1"># + y</span>
        <span class="nv">left: </span><span class="nx">positions</span><span class="p">.</span><span class="nx">fixed</span><span class="p">.</span><span class="nx">x</span>
        <span class="nv">opacity: </span><span class="mi">1</span>
      <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">fixed_start</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>If we're in start to fixed section</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">ratio = </span><span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">starts_at</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">fixed_start</span> <span class="o">-</span> <span class="nx">starts_at</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Process top</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">top_start = </span><span class="nx">positions</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">y</span>
      <span class="nv">top = </span><span class="p">(</span><span class="nx">ratio</span> <span class="o">*</span> <span class="nx">positions</span><span class="p">.</span><span class="nx">fixed</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">ratio</span> <span class="o">*</span> <span class="nx">top_start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">top_start</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Left</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">left_start = </span><span class="nx">positions</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">x</span>
      <span class="nv">left = </span><span class="p">(</span><span class="nx">ratio</span> <span class="o">*</span> <span class="nx">positions</span><span class="p">.</span><span class="nx">fixed</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">ratio</span> <span class="o">*</span> <span class="nx">left_start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">left_start</span>

      <span class="k">if</span> <span class="nx">@easeMoveIn</span>
        <span class="nv">top = </span><span class="nx">$</span><span class="p">.</span><span class="nx">easing</span><span class="p">[</span><span class="nx">@inEasing</span><span class="p">](</span><span class="nx">top</span><span class="p">,</span> <span class="nx">ratio</span><span class="p">,</span> <span class="nx">top_start</span><span class="p">,</span> <span class="nx">top</span> <span class="o">-</span> <span class="nx">top_start</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nv">left = </span><span class="nx">$</span><span class="p">.</span><span class="nx">easing</span><span class="p">[</span><span class="nx">@inEasing</span><span class="p">](</span><span class="nx">left</span><span class="p">,</span> <span class="nx">ratio</span><span class="p">,</span> <span class="nx">left_start</span><span class="p">,</span> <span class="nx">left</span> <span class="o">-</span> <span class="nx">left_start</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Fade ratio processing</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@fadeIn</span>
        <span class="nv">opacity =</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">easing</span><span class="p">[</span><span class="nx">@inEasing</span><span class="p">](</span><span class="nx">ratio</span><span class="p">,</span> <span class="nx">ratio</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>If we don't fade out, keep it to completely opaque</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span>
        <span class="nv">opacity = </span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Send animation params</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">{</span>
        <span class="nv">top: </span><span class="nx">top</span>
        <span class="nv">left: </span><span class="nx">left</span>
        <span class="nv">opacity: </span><span class="k">if</span> <span class="nx">@fadeIn</span> <span class="k">then</span> <span class="nx">ratio</span> <span class="k">else</span> <span class="mi">1</span>
      <span class="p">}</span>

    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>If we're in fixed to end section</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">ratio = </span><span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">fixed_end</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ends_at</span> <span class="o">-</span> <span class="nx">fixed_end</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Process top and left</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">top_start = </span><span class="nx">positions</span><span class="p">.</span><span class="nx">fixed</span><span class="p">.</span><span class="nx">y</span>
      <span class="nv">left_start = </span><span class="nx">positions</span><span class="p">.</span><span class="nx">fixed</span><span class="p">.</span><span class="nx">x</span>
      <span class="nv">top = </span><span class="p">(</span><span class="nx">ratio</span> <span class="o">*</span> <span class="nx">positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">ratio</span> <span class="o">*</span> <span class="nx">top_start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">top_start</span>
      <span class="nv">left = </span><span class="p">(</span><span class="nx">ratio</span> <span class="o">*</span> <span class="nx">positions</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">ratio</span> <span class="o">*</span> <span class="nx">left_start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">left_start</span>

      <span class="k">if</span> <span class="nx">@easeMoveOut</span>
        <span class="nv">top = </span><span class="nx">$</span><span class="p">.</span><span class="nx">easing</span><span class="p">[</span><span class="nx">@outEasing</span><span class="p">](</span><span class="nx">top</span><span class="p">,</span> <span class="nx">ratio</span><span class="p">,</span> <span class="nx">top_start</span><span class="p">,</span> <span class="nx">top</span> <span class="o">-</span> <span class="nx">top_start</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nv">left = </span><span class="nx">$</span><span class="p">.</span><span class="nx">easing</span><span class="p">[</span><span class="nx">@outEasing</span><span class="p">](</span><span class="nx">left</span><span class="p">,</span> <span class="nx">ratio</span><span class="p">,</span> <span class="nx">left_start</span><span class="p">,</span> <span class="nx">left</span> <span class="o">-</span> <span class="nx">left_start</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Fade ratio processing</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@fadeOut</span>
        <span class="nv">opacity = </span><span class="mi">1</span> <span class="o">-</span>
          <span class="p">(</span><span class="nx">ratio</span> <span class="o">*</span> <span class="nx">$</span><span class="p">.</span><span class="nx">easing</span><span class="p">[</span><span class="nx">@outEasing</span><span class="p">](</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">ratio</span><span class="p">,</span> <span class="nx">ratio</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="nx">ratio</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>If we don't fade out, keep it to completely opaque</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span>
        <span class="nv">opacity = </span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Send animation params</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">{</span>
        <span class="nv">top: </span><span class="nx">top</span> <span class="c1"># + y</span>
        <span class="nv">left: </span><span class="nx">left</span>
        <span class="nv">opacity: </span><span class="nx">opacity</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Scale item</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">resizeToScale: </span><span class="nf">(@scale, @parent_sizes) -&gt;</span>
    <span class="p">[</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">@sizes</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">@scale</span><span class="p">,</span> <span class="nx">@sizes</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">@scale</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Callback before resizing</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@params</span><span class="p">.</span><span class="nx">onResize</span><span class="p">(</span><span class="nx">@el</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">@params</span><span class="p">.</span><span class="nx">onResize</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Set element's css sizes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@el</span><span class="p">.</span><span class="nx">css</span>
      <span class="nv">width: </span><span class="nx">w</span>
      <span class="nv">height: </span><span class="nx">h</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Process positionz</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@processPositions</span><span class="p">()</span>

  <span class="nv">processPositionsFromRefObjectAt: </span><span class="nf">(y) -&gt;</span>
    <span class="nv">offsets = </span><span class="nx">@params</span><span class="p">.</span><span class="nx">refObject</span><span class="p">.</span><span class="nx">offset</span><span class="p">()</span>
    <span class="nv">positions = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">@positions</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@positions</span><span class="p">,</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">positions</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nv">x = </span><span class="nx">hash</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">left</span>
      <span class="nx">positions</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nv">y = </span><span class="nx">hash</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span>
    <span class="nx">positions</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>jQuery plugin to simplify class usage</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$.fn.pullItUp = </span><span class="nf">(options, value = null, container = $window) -&gt;</span>
  <span class="nv">is_setter = </span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">==</span> <span class="s">&#39;string&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>container = value if is_setter &amp;&amp; value
Wrap container if necessary</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">$container =</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">container</span><span class="p">.</span><span class="nx">jquery</span> <span class="o">!=</span> <span class="s">&#39;undefined&#39;</span> <span class="k">then</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="k">else</span> <span class="nx">container</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Lookup for existing scroll handler for container or create new one</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pullup = </span><span class="nx">$container</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;pullitup&#39;</span><span class="p">)</span>
  <span class="nx">unless</span> <span class="nx">pullup</span>
    <span class="nv">pullup = </span><span class="k">new</span> <span class="nx">Pullitup</span> <span class="nx">$container</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Cache it</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$container</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;pullitup&#39;</span><span class="p">,</span> <span class="nx">pullup</span><span class="p">)</span>


  <span class="k">if</span> <span class="nx">is_setter</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">pullup</span><span class="p">[</span><span class="nx">options</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;undefined&#39;</span>
    <span class="nx">pullup</span><span class="p">[</span><span class="nx">options</span><span class="p">]</span> <span class="nx">value</span>
  <span class="k">else</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">each</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Subscribe item to be scrolled</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pullup</span><span class="p">.</span><span class="nx">listen</span> <span class="k">this</span><span class="p">,</span> <span class="nx">options</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 